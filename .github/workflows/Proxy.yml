
# Tên của workflow
name: Cập nhật Proxy (Luôn tạo Commit)

# Các sự kiện sẽ kích hoạt workflow này
on:
  # Cho phép chạy thủ công để kiểm tra ngay lập tức
  workflow_dispatch:

  # Lên lịch chạy tự động mỗi 5 phút
  schedule:
    - cron: '*/5 * * * *'

# Các công việc (jobs) sẽ được thực thi
jobs:
  update-and-commit:
    # Chạy trên máy ảo Ubuntu
    runs-on: ubuntu-latest

    # Cấp quyền GHI vào repository
    permissions:
      contents: write

    # Các bước thực thi của job
    steps:
      # Bước 1: Lấy code từ repo về máy ảo
      - name: Checkout repository
        uses: actions/checkout@v4

      # Bước 2: Tải danh sách proxy trực tiếp từ ProxyScrape
      - name: Tải và lưu danh sách proxy
        run: |
          curl -L --fail -o proxies.txt "https://api.proxyscrape.com/v4/free-proxy-list/get?request=display_proxies&proxy_format=protocolipport&format=text"

      # Bước 3: Luôn luôn Commit và Push
      - name: Commit và Push (kể cả khi không có thay đổi)
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Thêm file vào để chuẩn bị commit
          git add proxies.txt
          
          # Tạo nội dung commit với dấu thời gian hiện tại (giờ UTC)
          COMMIT_MESSAGE="Heartbeat: Cập nhật proxy lúc $(date -u)"
          
          # Commit với tùy chọn --allow-empty để luôn tạo commit mới
          git commit --allow-empty -m "$COMMIT_MESSAGE"
          
          # Đẩy commit lên repository
          git push
          
          echo "Đã tạo commit mới thành công với nội dung: $COMMIT_MESSAGE"
