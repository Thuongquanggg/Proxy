name: ☢️ Proxy Tự động 3m
on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  long-running-update:
    runs-on: ubuntu-latest
    timeout-minutes: 355
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Cấu hình Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
      - name: Bắt đầu vòng lặp cập nhật (Luôn Commit)
        run: |
          while true; do
            echo "-------------------------------------------"
            echo "Bắt đầu chu kỳ mới lúc: $(date)"
            git pull
            echo "Đang tải proxy và ghi đè vào proxy.txt..."
            curl -s -o proxy.txt "https://api.proxyscrape.com/v4/free-proxy-list/get?request=display_proxies&proxy_format=protocolipport&format=text"
            git add proxy.txt
            echo "Đang tạo commit mới..."
            git commit --allow-empty -m "CI: Cập nhật proxy lúc $(date)"
            echo "Đang đẩy lên GitHub..."
            git push
            echo "Đã xong. Chờ 180 giây..."
            sleep 180
          done
